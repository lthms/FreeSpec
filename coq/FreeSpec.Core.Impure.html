<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>FreeSpec.Core.Impure</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library FreeSpec.Core.Impure</h1>

<div class="code">

<br/>

<br/>
</div>

<div class="doc">
In <span class="inlinecode"><span class="id" title="library">FreeSpec.Core.Interface</span></span>, we have introduced the <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Interface.html#interface"><span class="id" title="definition">interface</span></a></span> type, to
    model the set of primitives an impure computation can use. We also introduce
    <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Interface.html#MayProvide"><span class="id" title="record">MayProvide</span></a></span>, <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Interface.html#Provide"><span class="id" title="record">Provide</span></a></span> and <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Interface.html#Distinguish"><span class="id" title="record">Distinguish</span></a></span>. They are three type classes which
    allow for manipulating <i>polymorphic interface composite</i>.

<div class="paragraph"> </div>

    In this library, we provide the <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a></span> monad, defined after the
    <tt>Program</tt> monad introduced by the <tt>operational</tt> package (see
    <tt>https://github.com/whitequark/unfork#introduction</tt>). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Program.Program.html#"><span class="id" title="library">Program</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Setoids.Setoid.html#"><span class="id" title="library">Setoid</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Classes.Morphisms.html#"><span class="id" title="library">Morphisms</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ExtLib</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="library">MonadState</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">FreeSpec.Core</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="FreeSpec.Core.Interface.html#"><span class="id" title="library">Interface</span></a>.<br/>

<br/>
</div>

<div class="doc">
We introduce the <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a></span> monad to describe impure computations, that is
    computations which uses primitives from certain interfaces. 
<div class="paragraph"> </div>

<a id="lab9"></a><h1 class="section">Definition</h1>

<div class="paragraph"> </div>

 The <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a></span> monad is an inductive datatype with two parameters: the
    interface <span class="inlinecode"><span class="id" title="var">i</span></span> to be used, and the type <span class="inlinecode"><span class="id" title="var">α</span></span> of the result of the computation.
    The fact that <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a></span> is inductive rather than co-inductive means it is not
    possible to describe infinite computations.  This also means it is possible
    to interpret impure computations within Coq, providing an operational
    semantics for <span class="inlinecode"><span class="id" title="var">i</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a id="impure" class="idref" href="#impure"><span class="id" title="inductive">impure</span></a> (<a id="i:1" class="idref" href="#i:1"><span class="id" title="binder">i</span></a> : <a class="idref" href="FreeSpec.Core.Interface.html#interface"><span class="id" title="definition">interface</span></a>) (<a id="dbe7daa3f4200dd60831b0ac13fea06b" class="idref" href="#dbe7daa3f4200dd60831b0ac13fea06b"><span class="id" title="binder">α</span></a> : <span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
| <a id="local" class="idref" href="#local"><span class="id" title="constructor">local</span></a> (<a id="x:5" class="idref" href="#x:5"><span class="id" title="binder">x</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#dbe7daa3f4200dd60831b0ac13fea06b"><span class="id" title="variable">α</span></a>) : <a class="idref" href="FreeSpec.Core.Impure.html#impure:3"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:1"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#dbe7daa3f4200dd60831b0ac13fea06b"><span class="id" title="variable">α</span></a><br/>
| <a id="request_then" class="idref" href="#request_then"><span class="id" title="constructor">request_then</span></a> {<a id="596308ea39bf4a0991662603f9bf9af1" class="idref" href="#596308ea39bf4a0991662603f9bf9af1"><span class="id" title="binder">β</span></a>} (<a id="e:7" class="idref" href="#e:7"><span class="id" title="binder">e</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#i:1"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#596308ea39bf4a0991662603f9bf9af1"><span class="id" title="variable">β</span></a>) (<a id="f:8" class="idref" href="#f:8"><span class="id" title="binder">f</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#596308ea39bf4a0991662603f9bf9af1"><span class="id" title="variable">β</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#impure:3"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:1"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#dbe7daa3f4200dd60831b0ac13fea06b"><span class="id" title="variable">α</span></a>) : <a class="idref" href="FreeSpec.Core.Impure.html#impure:3"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:1"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#dbe7daa3f4200dd60831b0ac13fea06b"><span class="id" title="variable">α</span></a>.<br/>

<br/>
<span class="id" title="var">Arguments</span> <a class="idref" href="FreeSpec.Core.Impure.html#local"><span class="id" title="constructor">local</span></a> [<span class="id" title="var">i</span> <span class="id" title="var">α</span>] (<span class="id" title="var">x</span>).<br/>
<span class="id" title="var">Arguments</span> <a class="idref" href="FreeSpec.Core.Impure.html#request_then"><span class="id" title="constructor">request_then</span></a> [<span class="id" title="var">i</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span>] (<span class="id" title="var">e</span> <span class="id" title="var">f</span>).<br/>

<br/>
<span class="id" title="var">Register</span> <span class="id" title="var">impure</span> <span class="id" title="keyword">as</span> <span class="id" title="var">freespec.core.impure.type</span>.<br/>
<span class="id" title="var">Register</span> <span class="id" title="var">local</span> <span class="id" title="keyword">as</span> <span class="id" title="var">freespec.core.impure.local</span>.<br/>
<span class="id" title="var">Register</span> <span class="id" title="var">request_then</span> <span class="id" title="keyword">as</span> <span class="id" title="var">freespec.core.impure.request_then</span>.<br/>

<br/>
<span class="id" title="var">Declare</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">impure_scope</span>.<br/>
<span class="id" title="keyword">Bind</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">impure_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">impure</span>.<br/>
<span class="id" title="keyword">Delimit</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">impure_scope</span> <span class="id" title="keyword">with</span> <span class="id" title="var">impure</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab10"></a><h1 class="section">Monad Instances</h1>

<div class="paragraph"> </div>

 We then provide the necessary instances of the <tt>coq-prelude</tt> Monad
    typeclasses hierarchy. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a id="impure_bind" class="idref" href="#impure_bind"><span class="id" title="definition">impure_bind</span></a> {<a id="i:9" class="idref" href="#i:9"><span class="id" title="binder">i</span></a> <a id="01214f440e1ebbf02585b4d6c7d6f861" class="idref" href="#01214f440e1ebbf02585b4d6c7d6f861"><span class="id" title="binder">α</span></a> <a id="da447f7664616eb887dca80dc94f1d64" class="idref" href="#da447f7664616eb887dca80dc94f1d64"><span class="id" title="binder">β</span></a>} (<a id="p:12" class="idref" href="#p:12"><span class="id" title="binder">p</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:9"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#01214f440e1ebbf02585b4d6c7d6f861"><span class="id" title="variable">α</span></a>) (<a id="f:13" class="idref" href="#f:13"><span class="id" title="binder">f</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#01214f440e1ebbf02585b4d6c7d6f861"><span class="id" title="variable">α</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:9"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#da447f7664616eb887dca80dc94f1d64"><span class="id" title="variable">β</span></a>) : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:9"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#da447f7664616eb887dca80dc94f1d64"><span class="id" title="variable">β</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="FreeSpec.Core.Impure.html#p:12"><span class="id" title="variable">p</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="FreeSpec.Core.Impure.html#local"><span class="id" title="constructor">local</span></a> <span class="id" title="var">x</span> ⇒ <a class="idref" href="FreeSpec.Core.Impure.html#f:13"><span class="id" title="variable">f</span></a> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;| <a class="idref" href="FreeSpec.Core.Impure.html#request_then"><span class="id" title="constructor">request_then</span></a> <span class="id" title="var">e</span> <span class="id" title="var">g</span> ⇒ <a class="idref" href="FreeSpec.Core.Impure.html#request_then"><span class="id" title="constructor">request_then</span></a> <span class="id" title="var">e</span> (<span class="id" title="keyword">fun</span> <a id="x:16" class="idref" href="#x:16"><span class="id" title="binder">x</span></a> ⇒ <a class="idref" href="FreeSpec.Core.Impure.html#impure_bind:14"><span class="id" title="definition">impure_bind</span></a> (<span class="id" title="var">g</span> <a class="idref" href="FreeSpec.Core.Impure.html#x:16"><span class="id" title="variable">x</span></a>) <a class="idref" href="FreeSpec.Core.Impure.html#f:13"><span class="id" title="variable">f</span></a>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="impure_map" class="idref" href="#impure_map"><span class="id" title="definition">impure_map</span></a> {<a id="i:17" class="idref" href="#i:17"><span class="id" title="binder">i</span></a> <a id="27bc4a6ffbba547cad8b636e127a5e76" class="idref" href="#27bc4a6ffbba547cad8b636e127a5e76"><span class="id" title="binder">α</span></a> <a id="06df897bcb465780900da0eb706bc09e" class="idref" href="#06df897bcb465780900da0eb706bc09e"><span class="id" title="binder">β</span></a>} (<a id="f:20" class="idref" href="#f:20"><span class="id" title="binder">f</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#27bc4a6ffbba547cad8b636e127a5e76"><span class="id" title="variable">α</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#06df897bcb465780900da0eb706bc09e"><span class="id" title="variable">β</span></a>) (<a id="p:21" class="idref" href="#p:21"><span class="id" title="binder">p</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:17"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#27bc4a6ffbba547cad8b636e127a5e76"><span class="id" title="variable">α</span></a>) : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:17"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#06df897bcb465780900da0eb706bc09e"><span class="id" title="variable">β</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="FreeSpec.Core.Impure.html#impure_bind"><span class="id" title="definition">impure_bind</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#p:21"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <a id="x:22" class="idref" href="#x:22"><span class="id" title="binder">x</span></a> ⇒ <a class="idref" href="FreeSpec.Core.Impure.html#local"><span class="id" title="constructor">local</span></a> (<a class="idref" href="FreeSpec.Core.Impure.html#f:20"><span class="id" title="variable">f</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#x:22"><span class="id" title="variable">x</span></a>)).<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="impure_Functor" class="idref" href="#impure_Functor"><span class="id" title="instance">impure_Functor</span></a> : <span class="id" title="class">Functor</span> (<a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <span class="id" title="var">i</span>) :=<br/>
&nbsp;&nbsp;{ <span class="id" title="method">fmap</span> := @<a class="idref" href="FreeSpec.Core.Impure.html#impure_map"><span class="id" title="definition">impure_map</span></a> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="impure_pure" class="idref" href="#impure_pure"><span class="id" title="definition">impure_pure</span></a> {<a id="i:24" class="idref" href="#i:24"><span class="id" title="binder">i</span></a> <a id="6fb522096358674dd209e6ac77f89539" class="idref" href="#6fb522096358674dd209e6ac77f89539"><span class="id" title="binder">α</span></a>} (<a id="x:26" class="idref" href="#x:26"><span class="id" title="binder">x</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#6fb522096358674dd209e6ac77f89539"><span class="id" title="variable">α</span></a>) : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:24"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#6fb522096358674dd209e6ac77f89539"><span class="id" title="variable">α</span></a> := <a class="idref" href="FreeSpec.Core.Impure.html#local"><span class="id" title="constructor">local</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#x:26"><span class="id" title="variable">x</span></a>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <a id="impure_apply" class="idref" href="#impure_apply"><span class="id" title="definition">impure_apply</span></a> {<a id="i:27" class="idref" href="#i:27"><span class="id" title="binder">i</span></a> <a id="96ad1ac1716b109ad2893defa1eaf2a8" class="idref" href="#96ad1ac1716b109ad2893defa1eaf2a8"><span class="id" title="binder">α</span></a> <a id="a5c6f23c7325359d0b47cc06a48d3045" class="idref" href="#a5c6f23c7325359d0b47cc06a48d3045"><span class="id" title="binder">β</span></a>} (<a id="p:30" class="idref" href="#p:30"><span class="id" title="binder">p</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:27"><span class="id" title="variable">i</span></a> (<a class="idref" href="FreeSpec.Core.Impure.html#96ad1ac1716b109ad2893defa1eaf2a8"><span class="id" title="variable">α</span></a> <a class="idref" href="http://coq.inria.fr/distrib/V8.12.0/stdlib//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#a5c6f23c7325359d0b47cc06a48d3045"><span class="id" title="variable">β</span></a>)) (<a id="q:31" class="idref" href="#q:31"><span class="id" title="binder">q</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:27"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#96ad1ac1716b109ad2893defa1eaf2a8"><span class="id" title="variable">α</span></a>) : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:27"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#a5c6f23c7325359d0b47cc06a48d3045"><span class="id" title="variable">β</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="FreeSpec.Core.Impure.html#impure_bind"><span class="id" title="definition">impure_bind</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#p:30"><span class="id" title="variable">p</span></a> (<span class="id" title="keyword">fun</span> <a id="f:32" class="idref" href="#f:32"><span class="id" title="binder">f</span></a> ⇒ <span class="id" title="method">fmap</span> <a class="idref" href="FreeSpec.Core.Impure.html#f:32"><span class="id" title="variable">f</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#q:31"><span class="id" title="variable">q</span></a>).<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="impure_Applicative" class="idref" href="#impure_Applicative"><span class="id" title="instance">impure_Applicative</span></a> : <span class="id" title="class">Applicative</span> (<a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <span class="id" title="var">i</span>) :=<br/>
&nbsp;&nbsp;{ <span class="id" title="method">pure</span> := @<a class="idref" href="FreeSpec.Core.Impure.html#impure_pure"><span class="id" title="definition">impure_pure</span></a> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;; <span class="id" title="method">ap</span> := @<a class="idref" href="FreeSpec.Core.Impure.html#impure_apply"><span class="id" title="definition">impure_apply</span></a> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a id="impure_Monad" class="idref" href="#impure_Monad"><span class="id" title="instance">impure_Monad</span></a> (<a id="i:34" class="idref" href="#i:34"><span class="id" title="binder">i</span></a> : <a class="idref" href="FreeSpec.Core.Interface.html#interface"><span class="id" title="definition">interface</span></a>) : <span class="id" title="class">Monad</span> (<a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:34"><span class="id" title="variable">i</span></a>) :=<br/>
&nbsp;&nbsp;{ <span class="id" title="method">ret</span> := @<a class="idref" href="FreeSpec.Core.Impure.html#impure_pure"><span class="id" title="definition">impure_pure</span></a> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;; <span class="id" title="method">bind</span> := @<a class="idref" href="FreeSpec.Core.Impure.html#impure_bind"><span class="id" title="definition">impure_bind</span></a> <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc">
<a id="lab11"></a><h1 class="section">Defining Impure Computations</h1>

<div class="paragraph"> </div>

 FreeSpec users shall not use the <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a></span> monad constructors directly.  The
    <span class="inlinecode"><span class="id" title="method">pure</span></span> function from the <span class="inlinecode"><span class="id" title="library">Applicative</span></span> typeclass allows for defining pure
    computations which do not depend on any impure primitive.  The <span class="inlinecode"><span class="id" title="method">bind</span></span>
    function from the <span class="inlinecode"><span class="id" title="class">Monad</span></span> typeclass allows for seamlessly combine impure
    computations together.

<div class="paragraph"> </div>

    To complete these two monadic operations, we introduce the <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#request"><span class="id" title="definition">request</span></a></span>
    function, whose purpose is to define an impure computation that uses a given
    primitive <span class="inlinecode"><span class="id" title="var">e</span></span> from an interface <span class="inlinecode"><span class="id" title="var">i</span></span>, and returns its result.  <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#request"><span class="id" title="definition">request</span></a></span> does
    not parameterize the <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a></span> monad with <span class="inlinecode"><span class="id" title="var">i</span></span> directly, but rather with a
    generic interface <span class="inlinecode"><span class="id" title="var">ix</span></span>.  <span class="inlinecode"><span class="id" title="var">ix</span></span> is constrained with the <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Interface.html#Provide"><span class="id" title="record">Provide</span></a></span> notation, so
    that it has to provide at least <span class="inlinecode"><span class="id" title="var">i</span></span>'s primitives.  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="request" class="idref" href="#request"><span class="id" title="definition">request</span></a> `{<a id="H0:38" class="idref" href="#H0:38"><span class="id" title="binder">Provide</span></a> <a id="H0:38" class="idref" href="#H0:38"><span class="id" title="binder">ix</span></a> <a id="H0:38" class="idref" href="#H0:38"><span class="id" title="binder">i</span></a>} {<a id="6a5d9975c65bb14710c1a4443c3a35d4" class="idref" href="#6a5d9975c65bb14710c1a4443c3a35d4"><span class="id" title="binder">α</span></a>} (<a id="e:40" class="idref" href="#e:40"><span class="id" title="binder">e</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#i:36"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#6a5d9975c65bb14710c1a4443c3a35d4"><span class="id" title="variable">α</span></a>) : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#ix:35"><span class="id" title="variable">ix</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#6a5d9975c65bb14710c1a4443c3a35d4"><span class="id" title="variable">α</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="FreeSpec.Core.Impure.html#request_then"><span class="id" title="constructor">request_then</span></a> (<a class="idref" href="FreeSpec.Core.Interface.html#inj_p"><span class="id" title="method">inj_p</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#e:40"><span class="id" title="variable">e</span></a>) (<span class="id" title="keyword">fun</span> <a id="x:41" class="idref" href="#x:41"><span class="id" title="binder">x</span></a> ⇒ <span class="id" title="method">pure</span> <a class="idref" href="FreeSpec.Core.Impure.html#x:41"><span class="id" title="variable">x</span></a>).<br/>

<br/>
</div>

<div class="doc">
Note: there have been attempts to turn <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#request"><span class="id" title="definition">request</span></a></span> into a typeclass
    function (to seamlessly use <span class="inlinecode"><a class="idref" href="FreeSpec.Core.Impure.html#request"><span class="id" title="definition">request</span></a></span> with a <span class="inlinecode"><span class="id" title="library">MonadTrans</span></span> instance such as
    <span class="inlinecode"><span class="id" title="var">state_t</span></span>). The reason why it has not been kept into the codebase is that
    the flexibility it gives for writing code has a real impact on the
    verification process. It is simpler to reason about “pure” impure
    computations (that is, not within a monad stack), then wrapping these
    computations thanks to <span class="inlinecode"><span class="id" title="method">lift</span></span>.

<div class="paragraph"> </div>

    The <tt>coq-prelude</tt> provides notations (inspired by the do notation of
    Haskell) to write monadic functions more easily.  These notations live
    inside the <span class="inlinecode"><span class="id" title="var">monad_scope</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Instance</span> <a id="store_monad_state" class="idref" href="#store_monad_state"><span class="id" title="instance">store_monad_state</span></a> (<a id="s:42" class="idref" href="#s:42"><span class="id" title="binder">s</span></a> : <span class="id" title="keyword">Type</span>) (<a id="ix:43" class="idref" href="#ix:43"><span class="id" title="binder">ix</span></a> : <a class="idref" href="FreeSpec.Core.Interface.html#interface"><span class="id" title="definition">interface</span></a>) `{<a id="H0:45" class="idref" href="#H0:45"><span class="id" title="binder">Provide</span></a> <a id="H0:45" class="idref" href="#H0:45"><span class="id" title="binder">ix</span></a> <a id="H0:45" class="idref" href="#H0:45"><span class="id" title="binder">(</span></a><a id="H0:45" class="idref" href="#H0:45"><span class="id" title="binder">STORE</span></a> <a id="H0:45" class="idref" href="#H0:45"><span class="id" title="binder">s</span></a><a id="H0:45" class="idref" href="#H0:45"><span class="id" title="binder">)</span></a>}<br/>
&nbsp;&nbsp;: <span class="id" title="class">MonadState</span> <a class="idref" href="FreeSpec.Core.Impure.html#s:42"><span class="id" title="variable">s</span></a> (<a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#ix:43"><span class="id" title="variable">ix</span></a>) :=<br/>
&nbsp;&nbsp;{ <span class="id" title="method">put</span> := <span class="id" title="keyword">fun</span> (<a id="x:46" class="idref" href="#x:46"><span class="id" title="binder">x</span></a> : <span class="id" title="var">s</span>) ⇒ <a class="idref" href="FreeSpec.Core.Impure.html#request"><span class="id" title="definition">request</span></a> (<a class="idref" href="FreeSpec.Core.Interface.html#Put"><span class="id" title="constructor">Put</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#x:46"><span class="id" title="variable">x</span></a>)<br/>
&nbsp;&nbsp;; <span class="id" title="method">get</span> := <a class="idref" href="FreeSpec.Core.Impure.html#request"><span class="id" title="definition">request</span></a> <a class="idref" href="FreeSpec.Core.Interface.html#Get"><span class="id" title="constructor">Get</span></a><br/>
&nbsp;&nbsp;}.<br/>

<br/>
</div>

<div class="doc">
<a id="lab12"></a><h1 class="section">Lift</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a id="impure_lift" class="idref" href="#impure_lift"><span class="id" title="definition">impure_lift</span></a> `{<a id="H:48" class="idref" href="#H:48"><span class="id" title="binder">Monad</span></a> <a id="H:48" class="idref" href="#H:48"><span class="id" title="binder">m</span></a>} `(<a id="l:50" class="idref" href="#l:50"><span class="id" title="binder">l</span></a> : <a id="i:49" class="idref" href="#i:49"><span class="id" title="binder">i</span></a> <a class="idref" href="FreeSpec.Core.Init.html#f7397da22bdab7f77b06c5d98764e7b9"><span class="id" title="notation">~&gt;</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#m:47"><span class="id" title="variable">m</span></a>) : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:49"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Init.html#f7397da22bdab7f77b06c5d98764e7b9"><span class="id" title="notation">~&gt;</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#m:47"><span class="id" title="variable">m</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fix</span> <span class="id" title="var">aux</span> <a id="a:51" class="idref" href="#a:51"><span class="id" title="binder">a</span></a> (<a id="p:52" class="idref" href="#p:52"><span class="id" title="binder">p</span></a> : <a class="idref" href="FreeSpec.Core.Impure.html#impure"><span class="id" title="inductive">impure</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#i:49"><span class="id" title="variable">i</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#a:51"><span class="id" title="variable">a</span></a>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="FreeSpec.Core.Impure.html#p:52"><span class="id" title="variable">p</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="FreeSpec.Core.Impure.html#local"><span class="id" title="constructor">local</span></a> <span class="id" title="var">x</span> ⇒ <span class="id" title="method">ret</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="FreeSpec.Core.Impure.html#request_then"><span class="id" title="constructor">request_then</span></a> <span class="id" title="var">e</span> <span class="id" title="var">f</span> ⇒ <span class="id" title="notation">let</span><span class="id" title="notation">×</span> <a id="x:55" class="idref" href="#x:55"><span class="id" title="binder">x</span></a> <span class="id" title="notation">:=</span> <a class="idref" href="FreeSpec.Core.Impure.html#l:50"><span class="id" title="variable">l</span></a> <span class="id" title="var">_</span> <span class="id" title="var">e</span> <span class="id" title="notation">in</span> <a class="idref" href="FreeSpec.Core.Impure.html#aux:53"><span class="id" title="variable">aux</span></a> <a class="idref" href="FreeSpec.Core.Impure.html#a:51"><span class="id" title="variable">a</span></a> (<span class="id" title="var">f</span> <a class="idref" href="FreeSpec.Core.Impure.html#x:55"><span class="id" title="variable">x</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>